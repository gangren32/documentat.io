# Что такое Unicode и чем отличаются кодировки UTF-8 и UTF-16.
## Что такое Unicode?
**Unicode** — это универсальный стандарт кодирования символов. Он предлагает основы для обработки, хранения и обмена текстовыми данными на разных языках для множества программного обеспечения. Он разрабатывается компанией [«Unicode Consortium»](https://home.unicode.org) с начала 90-х годов.

До изобретения Unicode, кодирование символов производилось с помощью однобайтовых систем, наиболее известной из которых является **ASCII** (American standard code for information interchange). Она представляет собой таблицу из 256 символов, нижняя половина (0-127) которой отводится под US-ASCII (основные символы латинского алфавита), а верхняя половина (128-255) принадлежит к национальным языкам. В этом и кроется проблема её применения, т.к. символов национальных языков больше, чем 128. До появления универсального стандарта, существовало большое количество систем кодировок, основанных на ASCII, где только нижняя часть сохраняла свои значения. Поэтому декодирование текстов с символами разные алфавитов было проблематично, т.к. разные системы кодировок по-разному отражали символы со значениями от 128 до 255. Для преодоления этого ограничения и началась разработка 16-битной системы, которая учитывала бы все возможные символы мировых письменных систем.

За счёт увеличения объёма информации, таблица Unicode позволяет придать значение 1 114 112 символов. Однако, на сегодня в неё включено только 137 994 символа. Такая таблица именуется **кодовым пространством *(codespace)***. Она отображается в качестве диапазона целых положительных чисел, записываемых в шестнадцатеричной системе счисления, от 0 до 10FFFF. Конкретное число здесь обозначает определённую ячейку в таблице и называется **кодовой позицией *(code point)***. Она записывается в виде «U+XXXXXX», где «U» — специальный префикс, обозначающий кодировку Unicode, а «XXXXXX» — и есть само число. Когда абстрактный символ занимает своё место в таблице, он становится **закодированным символом *(encoded character)***. Их количество постоянно увеличивается, в связи с чем выходят новые стандарты Unicode. На данный момент актуальной является версия [12.1.0](https://unicode.org/versions/Unicode12.1.0/), выпущенная в мае 2019 года. С помощью такого разделения, стандарт Unicode состоит из двух частей:
- **Universal character set, UCS** — универсальный набор символов, который определяет способы их кодирования.
- **Unicode transformation format, UTF** — формат преобразования Юникода, определяющий способы хранения и передачи символов.

В связи с тем, что кодовое пространство Unicode позволяет хранить более миллиона символов, оно разделяется на семнадцать плоскостей:
- **0 — Базовая многоязыковая плоскость *(Basic multilingual plane, BMP)*.** В ней находятся основные символы часто употребляемых языковых систем. Находится в диапазоне U+0000...U+FFFF.
- **1 — Дополнительная многоязыковая плоскость *(Supplementary multilingual plane, SMP)*.** Используется для неиспользуемых языковых систем. Находится в диапазоне U+10000...U+1FFFF.
- **2 — Дополнительная иероглифическая плоскость *(Supplementary ideographic plane, SIP)*.** Используется для редких китайский иероглифов. Находится в диапазоне U+20000...U+2FFFF.
- **3 — Третичная иероглифическая плоскость *(Tertiary ideographic plane, TIP)*.** Используется для архаичных китайских иероглифов. Находится в диапазоне U+30000...U+3FFFF.
- **4-13 —** не используются. Диапазон — U+40000...U+DFFFF.
- **14-15 — Дополнительная плоскость особого назначения *(Supplementary special-purpose plane, SSP)***. Диапазон — U+E0000...U+EFFFF.
- **15-16 — Дополнительные области для частного использования *(Supplementary private use area, SPUA-A/B)*.** Диапазон — U+F0000...U+10FFFF.

Стандарт Unicode построен на десяти базовых принципах, которые обеспечивают согласованность ради простоты и эффективности, а также сохранения совместимости для обмена с другими стандартами:
1. **Универсальность.** Стандарт Unicode представляет собой единый универсальный перечень всех известных видов письменности и символов.
2. **Эффективность.** Все символы Unicode просты для обработки, т.к. их обозначения стандартизированы, а сами они объединены по группам.
3. **Использование символов, а не глифов.** Если символы представляют собой знаки, которые наделяются определенным значением, то глифы – это форма представления знака на письме. Таким образом, Unicode кодирует сами символы, а не их визуализацию.
4. **Семантика.** В Unicode каждый символ имеет свою определенную семантику (регистр, направление и т.п.)
5. **Простой текст.** Он представляет собой чистую последовательность символов, без наделения их значением. Именно такой текст и описывает Unicode.
6. **Логический порядок.** Т.к. текст может выводиться разными способами (слева-направо, справа-налево, сверху-вниз), в Unicode содержатся специальные символы, позволяющие правильно и логично обрабатывать их.
7. **Унификация.** Стандарт Unicode унифицирует одинаковые символы в разных языках по-разному. Таким образом, каждый символ является уникальным. 
8. **Динамическая композиция.** Определённые символы могут быть составлены динамически, т.к. Unicode использует базовые и комбинирующие символы. Первые используются в своём значении, а вторые добавляются к базовым и меняют их смысл. Например, умлауты (точки сверху) над буквой «Ä».
9. **Стабильность.** Символы в Unicode не могут быть переназначены, а ключевые свойства их неизменны.
10. **Конвертируемость.** Unicode гарантирует конвертируемость с другими широко известными стандартами.

## Кодировки UTF-8 и UTF-16

Изначально, Unicode разрабатывался как шестнадцатибитная кодировка с фиксированной шириной символа. Изначально количество возможных символов стало 65 536. В 1996 году была представлена новая версия с переменной длиной кодов, отведя особую область для «суррогатных пар». Эта версия и получила современное обозначение **UTF-16**.

Она позволяет записывать символы в диапазоне от U+0000 до U+10FFFF. Чтобы сохранить возможность фиксировать символы в 16 битах, диапазон от U+E000 до U+10FFFF сохраняется в виде **«суррогатных пар»**. Они состоят из двух цифр. Первое из них относится к диапазону от U+D800 до U+DB7F, второе — к диапазону от U+DC00 до U+DFFF. Этот участок не принадлежит никаким символам и предназначен для кодировки. Таким образом, сохраняется размерность и увеличивается количество возможных символов до 1 114 112.

Код в такой кодировки состоит из «старшего» и «младшего» байтов. Проблема тут в том, что сейчас существует два способа хранения 16-битовых чисел: иногда «старший» байт стоит «младшим», а иногда наоборот. Персональные компьютеры чаще используют первый вариант, а большие компьютеры и смартфоны — второй. Поэтому, для того, чтобы обозначить порядок, разработаны две отдельные версии UTF-16: **UTF-16BE** и **UTF-16LE**. В первом случае, сохраняется прямой порядок от старшего к младшему («Big Endian»), во втором — обратный («Little Endian»).

Также для обозначения порядка используется **«маркер порядка байтов»** («byte order mark»). Так называется символ «неразрывный пробел нулевой ширины», который кодируется как «U+FEFF». При использовании прямого порядка он сохранит свою кодировку. В случае обратного порядка он станет «U+FFEF». Отдельно отметит, что этот маркер может использоваться для обозначения использования кодировки Unicode как таковой.

Стандарт UTF-16 делится на два блока. В первом размер символа составляет 2 байта и он включает в себя базовую многоязыковую плоскость. Второй блок состоит из остальных плоскостей и содержит в себе уже 4 байта.

Данная кодировка используется в ОС Windows, Java, C++, PHP, MySQL. К её плюсам относят то, что, например, иероглифические системы письма требует для кодировки всего 2 байта, в отличие от 3 в UTF-8. Процесс декодирования тогда значительно облегчается. К недостаткам принято относить то, что для символов латинского алфавита она использует 2 байта, вместо 1, как в UTF-8, что приводит к лишнему расходу памяти.

**UTF-8** была разработана годом позже UTF-16 — в 1992 году. Она представляет собой систему с динамическим кодированием, где размер символа зависит от его положения в кодовой позиции (от 1 до 4 байт). Её особенностью является то, что она повторяет первые 128 координат таблицы ASCII (латинские и основные небуквенные символы). Это свойство делает UTF-8 обратно совместимой с ней.

Суть данной кодировки сводится к тому, что чем больше кодовая позиция символа в кодовом пространстве, тем больше байт требуется для его представления. Как уже было сказано выше, первые 128 символов требуют всего 1 байт. Следующим 1920 символам надо 2 байта. Среди них представлены другие нелатинские алфавитные системы, такие как кириллица, греческий, арабский, иврит и другие. 3 байта потребуются символам с кодами от 2048. Там в основном находятся иероглифы китайского, корейского, японского языков. И те символы, чьи коды начинаются с 65536, задействуют 4 байта. В целом символы UTF-8 кодируются из Unicode согласно следующей таблицы:

| **Двоичный код символа** | **Первый байт** | **Второй байт** | **Третий байт** | **Четвёртый байт** |
|:--|:--|:--|:--|:--|
| 00000000 0xxxxxxx | 0xxxxxxx |  |  |  |
| 00000yyy yyxxxxxx | 110yyyyy | 10xxxxxx |  |  |
| zzzzyyyy yyxxxxxx | 1110zzzz | 10yyyyyy | 10xxxxxx |  |
| 000uuuuu zzzzyyyy yyxxxxxx | 11110uuu | 10uuzzzz | 10yyyyyy | 10xxxxxx |

Одним из свойств данной системы является способность к самосинхронизации. Это означает, что в случае сбоя, когда программа неверно считывает код символа, она исправляет сама себя и выводить корректные символы. К достоинствам UTF-8 также можно отнести и то, что байты во всех компьютерах хранятся по возрастанию адресов, поэтому в этом случае не требуется вводить «суррогатные пары» и обозначения «BE/LE». Однако, «маркер порядка байтов» здесь также может использоваться, но только для указания того, что дальше пойдёт набор символов Unicode. Он принимает значение здесь «EFBBEF» или же «1110 1111 1011 1011 1011 1111» в двоичной системе счисления. Заметим, что использование такого маркера лишает возможности совместимости с ASCII, поскольку она не сможет его прочитать.

UTF-8 используется в Unix-подобных ОС и в таких текстовых редакторах, как Notepad++ и Sublime Text. Отметим, что её применение в редакторах успешнее реализуется там, где предстоит применять только латиницу или смешанный набор символов с тем, которые кодируются двумя байтами. Если же планируется использовать иероглифы, то лучше будет использовать UTF-16, т.к. в ней они занимают 2 байта, а в UTF-8 — 3. В целом разработчики стандарта предлагают следующую таблицу различий между системами:

| **Название** | **UTF-8** | **UTF-16** | **UTF-16BE** | **UTF-16LE** |
|:--|:--|:--|:--|:--|
| Наименьшая кодовая позиция | 0000 | 0000 | 0000 | 0000 |
| Максимальная кодовая позиция | 10FFFF | 10FFFF | 10FFFF | 10FFFF |
| Размер единицы кода | 8 бит | 16 бит | 16 бит | 16 бит |
|  Наименьшее количество байт на символ| 1 | 2 | 2 | 2 |
| Наибольшее количество байт на символ | 4 | 4 | 4 | 4 |
| Порядок | N/A | «Маркер» | Прямой | Обратный

